#!/bin/bash
#SBATCH --partition=workq
#SBATCH --job-name=inshimtu
#SBATCH --time=00:15:00
#SBATCH --output=inshimtu.%j.out
#SBATCH --error=inshimtu.%j.err                                     
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1

INSHIMTU_ROOT="/lustre/project/k1033/Development/Inshimtu"
INSHIMTU_DIR="$INSHIMTU_ROOT/build.shaheen"

SRC_DIR="/lustre/project/k1033/Development/Inshimtu/examples"
DEVSHM_DIR="/dev/shm/$USER-inshimtu-testing"

# Load Modules
module use /lustre/project/k1033/sw/easybuild/modules/all
module add Boost/1.61.0-CrayGNU-2016.07.KSL
module add ParaView/5.3.0-CrayGNU-2016.07.KSL-server-mesa
module add cray-hdf5-parallel/1.10.0.1

# Note: For profiling support (if Inshimtu built with profiling)
export LD_LIBRARY_PATH="$INSHIMTU_DIR":$LD_LIBRARY_PATH


srun mkdir "$DEVSHM_DIR"
srun cp -r "$SRC_DIR/testing" "$DEVSHM_DIR"
srun cp "$SRC_DIR/testing.done" "$DEVSHM_DIR"

srun "$INSHIMTU_DIR/Inshimtu" -w "$DEVSHM_DIR/testing" -d "$DEVSHM_DIR/testing.done" -s "$INSHIMTU_ROOT/testing/pipelines/gridviewer_glendon_22222.py" -i "$DEVSHM_DIR/testing/filename_*.vti"

#srun cp -r "$DEVSHM_DIR/output" "$OUT_DIR"
#srun rm -rf "$DEVSHM_DIR"

